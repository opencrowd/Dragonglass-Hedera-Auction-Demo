# Backend for Dragonglass Auction Demo With Smart Contract Events

## Overview
This project is the backend for the Dragonglass Auction Demo which showcases the contract event subscription feature of Dragonglass, a OpenCrowd product.
The demo is an auction engine based on a solidity smart contract.  

This demo creates the auction contract, starts an auction, and allows participants with Hedera Hashgraph accounts to bid in tiny bars in a time-limited auction. 
After auction start, the highest bidder and the amount are displayed and the past bids are also shown in the descending order of bidding time. 
At the end of the auction, the winner will be declared and the proceeds goes to the beneficiary account of the auction.  

In the demo, the events generated by the auction contract are subscribed via Dragonglass and used to power the display of highest bid, bidding history and the winner at the end of the auction.  

## Description
A solidity smart contract controls the inner workings of the auction. It has the following important methods: 

- A constructor that takes two arguments: the auction duration and the beneficiary account. 
- A start timer function to start a new auction
- A payable bid function to allow bidding. A HighestBidIncreased event will be generated if the bid is higher than the current highest bid.
- A auction end function to close the auction after bidding time is up. The first call to this function generates a AuctionEnded event, which declares the winner. 

This backend server provides a set of rest APIs to interact with the auction contract including the following endpoints: 

- /newAuction/{biddingTimeSec}/{beneficiaryAddr}: creates a new auction and returns the contract id 
- /startTimer/{contractId}: starts the auction
- /bid/{bidder}/{amount}/{contractAddr}: posts a bid and also starts random bidding
- /endAuction/{bidder}/{contractAddr}: ends the auction 

Source for the original auction contract
The demo auction contract is adapted from the
[Simple Open Auction](https://solidity.readthedocs.io/en/v0.5.3/solidity-by-example.html)

## Quickstart

### Requirements

- JDK 11
- [Hedera Java SDK](https://github.com/hashgraph/hedera-sdk-java.git)

### Installation
```bash
git clone https://github.com/opencrowd/Dragonglass-Hedera-Auction-Demo.git
cd Dragonglass-Hedera-Auction-Demo/auction
nano src/main/resources/application-mainnet.yml # Insert account information
(for testnet run: nano src/main/resources/application-testnet.yml # Insert account information)
./mvnw clean install
```
### Yaml Profile Configuration
```text
hedera.account:
  Alice:
    ID: 0.0.x
    KEY: <your account's private key in hex, length of 96 characters>
  manager:
    ID: 0.0.x
    KEY: <your account's private key in hex, length of 96 characters>
    PUBLIC_KEY: <your account's public key in hex, length of 64 (raw key bytes) or 88 (DER-encoded) characters>
```
### Running against mainnet
mvn spring-boot:run -Dspring-boot.run.profiles=mainnet

### Running against testnet
mvn spring-boot:run -Dspring-boot.run.profiles=testnet

### REST API access
Once the auction server is running, click this link: 
[Dragonglass Auction Demo Rest API](http://localhost:8081/swagger-ui.html#/)

To change the port, edit server.port in src/main/resources/application.yml # Insert account information

### Project structure
- ./README.md: this file
- ./pom.xml
- ./src/main/java: java source code
- ./src/main/resources: yml config files, and contract bin file
- ./auction/auction.sol: original auction contract solidity code
- ./auction/auctionTimer.sol: modified auction contract solidity code used for the demo
- ./auction/auctionTimer_sol_SimpleAuction.bin: modified auction contract binary file
- ./auction/auctionTimer_sol_SimpleAuction.abi: modified auction contract ABI file

## Developer Contact
Hua Li, OpenCrowd, hli@opencrowd.com
